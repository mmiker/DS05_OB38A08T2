C51 COMPILER V9.59.0.0   ADC                                                               03/04/2021 14:28:25 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE ADC
OBJECT MODULE PLACED IN .\Objects\ADC.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\src\ADC.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\inc;..\mmi_inc;..\
                    -dqiot_inc) DEBUG OBJECTEXTEND PRINT(.\Listings\ADC.lst) TABS(2) OBJECT(.\Objects\ADC.obj)

line level    source

   1          #include "OB38A08T2.h"
   2          #include "ADC.h"
   3          #include "Timer.h"
   4          
   5          unsigned int n_data = 0x0000;
   6          bit ADCfinish = 0;
   7          
   8          void ADC_Start(unsigned char n_ADC_CH)
   9          {
  10   1          ADCC2 = n_ADC_CH; //Set a new channel 使能ADC取样
  11   1          ADCC2 |= 0x80;    //ADC start conversion
  12   1      }
  13          
  14          void ADC_Init(void)
  15          {
  16   1          ADCC1 = d_ADCnEN0;                 //Set ADC channel
  17   1          ADCCS = d_ADCnEN1 | d_ADC_CLK_Sel; //Set ADC channel & Select ADC clock
  18   1          IEADC = 1;                         //Enable ADC interrupt.
  19   1          EA = 1;
  20   1      }
  21          
  22          unsigned int ADC_Read12() //12-bit ADC
  23          {
  24   1          unsigned int n_ADCD12 = 0x0000;
  25   1          n_ADCD12 = (ADCDH << 4) | ADCDL; //12-bit ADC
  26   1          return n_ADCD12;
  27   1      }
  28          
  29          void ADCInterrupt(void) interrupt d_ADC_Vector // ADC Interrupt Vector Address 0053h => interrupt 10
  30          {
  31   1          n_data = ADC_Read12(); //Read ADC
  32   1          ADCfinish = 1;
  33   1      }
  34          
  35          unsigned int ADC(void)
  36          {
  37   1          if (d_ADCnEN0 & 0x01)
  38   1          {
  39   2              ADC_Start(d_ADC_CH0_IN);
  40   2              while (!ADCfinish)
  41   2                  ;
  42   2              ADCfinish = 0;
  43   2          }
  44   1          if (d_ADCnEN0 & 0x02)
  45   1          {
  46   2              ADC_Start(d_ADC_CH1_IN);
  47   2              while (!ADCfinish)
  48   2                  ;
  49   2              ADCfinish = 0;
  50   2          }
  51   1          if (d_ADCnEN0 & 0x04)
  52   1          {
  53   2              ADC_Start(d_ADC_CH2_IN);
  54   2              while (!ADCfinish)
C51 COMPILER V9.59.0.0   ADC                                                               03/04/2021 14:28:25 PAGE 2   

  55   2                  ;
  56   2              ADCfinish = 0;
  57   2          }
  58   1          if (d_ADCnEN0 & 0x08)
  59   1          {
  60   2              ADC_Start(d_ADC_CH3_IN);
  61   2              while (!ADCfinish)
  62   2                  ;
  63   2              ADCfinish = 0;
  64   2          }
  65   1          if (d_ADCnEN0 & 0x10)
  66   1          {
  67   2              ADC_Start(d_ADC_CH4_IN);
  68   2              while (!ADCfinish)
  69   2                  ;
  70   2              ADCfinish = 0;
  71   2          }
  72   1          if (d_ADCnEN0 & 0x20)
  73   1          {
  74   2              ADC_Start(d_ADC_CH5_IN);
  75   2              while (!ADCfinish)
  76   2                  ;
  77   2              ADCfinish = 0;
  78   2          }
  79   1          if (d_ADCnEN0 & 0x40)
  80   1          {
  81   2              ADC_Start(d_ADC_CH6_IN);
  82   2              while (!ADCfinish)
  83   2                  ;
  84   2              ADCfinish = 0;
  85   2          }
  86   1          if (d_ADCnEN0 & 0x80)
  87   1          {
  88   2              ADC_Start(d_ADC_CH7_IN);
  89   2              while (!ADCfinish)
  90   2                  ;
  91   2              ADCfinish = 0;
  92   2          }
  93   1          if (d_ADCnEN1 & 0x80)
  94   1          {
  95   2              ADC_Start(d_ADC_BG_IN);
  96   2              while (!ADCfinish)
  97   2                  ;
  98   2              ADCfinish = 0;
  99   2          }
 100   1      
 101   1          return n_data;
 102   1      }
 103          
 104          /**
 105            * @brief  get adc data
 106            * @param  adc_channel_addr:ADC channel
 107            * @return none
 108            * @note   none
 109            * @see    none
 110            */
 111          uint16_t get_adc_data(uint8_t adc_channel_addr)
 112          {
 113   1          uint16_t adc_data;
 114   1          adc_data = ADC();
 115   1          return adc_data;
 116   1      }
C51 COMPILER V9.59.0.0   ADC                                                               03/04/2021 14:28:25 PAGE 3   

*** WARNING C280 IN LINE 111 OF ..\src\ADC.c: 'adc_channel_addr': unreferenced local variable
 117          
 118          /**
 119            * @brief  获取adc数据的平均值
 120            * @param  adc_channel_addr ADC channel; times 时间ms
 121            * @return none
 122            * @note   none
 123            * @see    none
 124            */
 125          static uint16_t Get_Adc_Average(uint8_t adc_channel_addr, uint8_t times)
 126          {
 127   1          uint32_t temp_val = 0;
 128   1          uint8_t t;
 129   1          for (t = 0; t < times; t++)
 130   1          {
 131   2              temp_val += get_adc_data(adc_channel_addr);
 132   2              TIMER1_Delay(5);
 133   2          }
 134   1          return temp_val / times;
 135   1      }
 136          
 137          /**
 138            * @brief  电压计算
 139            * @param  none
 140            * @return none
 141            * @note   none
 142            * @see    none
 143            */
 144          unsigned char adc_VolT(void)
 145          {
 146   1          unsigned int adcx;
 147   1          float temp;
 148   1      
 149   1          // ADC_ENABLE();
 150   1          TIMER1_Delay(5);
 151   1          adcx = Get_Adc_Average(d_ADCnEN0, 10); //获取10ms平均值
 152   1          // ADC_DISABLE();
 153   1      
 154   1          temp = (float)adcx * (3.3 / 4096); //计算电压
 155   1      
 156   1          if (temp < 2.22) //4.8v=2.22
 157   1              return 2;
 158   1          else if (temp < 2.3525) //<5v=2.3525
 159   1              return 1;           //mmi_dq_aud_play_with_id(AUD_BASE_ID_LOW_BATTERY);
 160   1      
 161   1          return 0;
 162   1      }
*** WARNING C294 IN LINE 39 OF ..\src\ADC.c: unreachable code
*** WARNING C294 IN LINE 46 OF ..\src\ADC.c: unreachable code
*** WARNING C294 IN LINE 53 OF ..\src\ADC.c: unreachable code
*** WARNING C294 IN LINE 60 OF ..\src\ADC.c: unreachable code
*** WARNING C294 IN LINE 67 OF ..\src\ADC.c: unreachable code
*** WARNING C294 IN LINE 74 OF ..\src\ADC.c: unreachable code
*** WARNING C294 IN LINE 88 OF ..\src\ADC.c: unreachable code
*** WARNING C294 IN LINE 95 OF ..\src\ADC.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    328    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      2      12
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.59.0.0   ADC                                                               03/04/2021 14:28:25 PAGE 4   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  9 WARNING(S),  0 ERROR(S)
